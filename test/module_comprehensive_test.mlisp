;; Comprehensive module system test

;; Test 1: Simple module with variable
(module simple (export x)
  (:= x 42))

(import simple)
x

;; Test 2: Module with function
(module math (export add sub)
  (:= add (=> (x y) (+ x y)))
  (:= sub (=> (x y) (- x y))))

(import math)
(add 10 5)
(sub 10 5)

;; Test 3: Module with multiple definitions
(module utils (export greet double)
  (:= greet (=> (name) (@ "Hello, " name "!")))
  (:= double (=> (x) (* x 2))))

(import utils greet double)
(greet "World")
(double 21)

;; Test 4: Selective import
(module mixed (export public internal)
  (:= public 100)
  (:= internal 200)
  (:= secret 300))

(import mixed public)
public
;; internal should not be accessible
;; secret should not be accessible

;; Test 5: Module with let bindings
(module let-test (export result)
  (%= ((x 10)
       (y 20))
    (:= result (+ x y))))

(import let-test)
result

;; Test 6: Module with function definition
(module func-test (export factorial)
  (|= factorial (n)
    (? (== n 0)
       1
       (* n (factorial (- n 1))))))

(import func-test)
(factorial 5)

;; Test 7: Module accessing parent environment (primitives)
(module uses-prim (export add-one)
  (:= add-one (=> (x) (+ x 1))))

(import uses-prim)
(add-one 41)

;; Test 8: Expression evaluation in module body (non-definition)
(module expr-test (export value)
  (:= value (+ 1 2 3)))

(import expr-test)
value
